---
layout: post
title:  2019/3/7 逆向工程
date:   2019-3-7 20:05:00 +0800
categories: 文章
tag: interview
---

* content
{:toc}
​	今天开始接触逆向工程拆除“二进制炸弹”的题目，题目中推荐了两个工具：objdump工具和gdb调试器，于是决定先从概念和工具入手，了解一下逆向工程。

# 逆向工程

​	逆向工程，又称反向工程，是一种技术过程，即对一项目标产品进行逆向分析及研究，从而演绎并得出该产品的处理流程、组织结构、功能性能规格等设计要素，以制作出功能相近，但又不完全一样的产品。逆向工程源于商业及军事领域中的硬件分析。其主要目的是，在无法轻易获得必要的生产信息下，直接从成品的分析，推导产品的设计原理。

​	逆向工程可能会被误认为是对知识产权的严重侵害，但是在实际应用上，反而可能会保护知识产权所有者。例如在集成电路领域，如果怀疑某公司侵犯知识产权，可以用逆向工程技术来寻找证据。

# objdump工具

- objdump是什么？

  objdump工具用来显示二进制文件的信息，就是以一种可阅读的格式让你更多地了解二进制文件可能带有的附加信息。

- objdump常用参数：

  - -f 显示文件头信息
  - -D 反汇编所有section (-d反汇编特定section)
  - -h 显示目标文件各个section的头部摘要信息
  - -t 显示文件的符号表入口。类似于nm -s提供的信息
  - -r 显示文件的重定位入口。如果和-d或者-D一起使用，重定位部分以反汇编后的格式显示出来。
  - -x 显示所有可用的头信息，包括符号表、重定位入口。-x 等价于 -a -f -h -r -t 同时指定。
  - -i 显示对于 -b 或者 -m 选项可用的架构和目标格式列表。
  - -R 显示文件的动态重定位入口，仅仅对于动态目标文件有意义，比如某些共享库。
  - -S 尽可能反汇编出源代码，尤其当编译的时候指定了-g这种调试参数时，效果比较明显。隐含了-d参数。

  [参考资料][https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/objdump.html]

# gdb调试器

- gdb是什么？

  GDB是一个由GNU开源组织发布的、UNIX/LINUX操作系统下的、基于命令行的、功能强大的程序调试工具。 对于一名Linux下工作的c++程序员，gdb是必不可少的工具。

- gdb主要的功能：

  - 启动程序，可以按照工程师自定义的要求随心所欲的运行程序。
  - 让被调试的程序在工程师指定的断点处停住，断点可以是条件表达式。
  - 当程序被停住时，可以检查此时程序中所发生的事，并追索上文。
  - 动态地改变程序的执行环境。

- 启动gdb：

  - 对于C/C++程序的调试,需要在编译前就加上-g选项:

    ~~~
    $g++ -g hello.cpp -o hello
    ~~~

  - 调试可执行文件：（program也就是你的执行文件，一般在当前目录下）

    ~~~
    $gdb <program>
    ~~~

- gdb交互命令：（交互模式下直接回车的作用是重复上一指令，对于单步调试非常方便；）
  - 运行：
    - run：简记为 r ，其作用是运行程序，当遇到断点后，程序会在断点处停止运行，等待用户输入下一步的命令。
    - continue （简写c ）：继续执行，到下一个断点处（或运行结束）
    - next：（简写 n），单步跟踪程序，当遇到函数调用时，也不进入此函数体；此命令同 step 的主要区别是，step 遇到用户自定义的函数，将步进到函数中去运行，而 next 则直接调用函数，不会进入到函数体内。
    - step （简写s）：单步调试如果有函数调用，则进入函数；与命令n不同，n是不进入调用的函数的
    - until：当你厌倦了在一个循环体内单步跟踪时，这个命令可以运行程序直到退出循环体。
    - until+行号： 运行至某行，不仅仅用来跳出循环
    - finish： 运行程序，直到当前函数完成返回，并打印函数返回时的堆栈地址和返回值及参数值等信息。
    - call 函数(参数)：调用程序中可见的函数，并传递“参数”，如：call gdb_test(55)
    - quit：简记为 q ，退出gdb
  - 设置断点：break n （简写b n）:在第n行处设置断点
  - 查看源代码：
    - list 简记为 l ，其作用就是列出程序的源代码，默认每次显示10行
    - list 行号：将显示当前文件以“行号”为中心的前后10行代码，如：list 12
  - 打印表达式：print 表达式：简记为 p ，其中“表达式”可以是任何当前正在被测试程序的有效表达式，print a：将显示整数a的值。
  - 查询运行信息
  - 分割窗口：用于分割窗口，可以一边查看代码，一边测试。

[参考资料][https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/gdb.html]

# 解题

对题目的大致了解：

- 题目中的压缩包中含有两个文件：

  bomb.c：代码框架，bomb主程序即main函数，没有细节。（我先打开了bomb.c，看到了六个phase函数，特别抽象，没有什么具体的信息）
  bomb： bomb的可执行程序。linux下的可执行程序，需要0或1个命令行参数。

- 程序运行在linux环境之中，程序运行中有6个关卡（6个phase），每个phase需要用户在终端上输入特定的字符或者数字才能通关，否则会引爆炸弹！

- 使用gdb工具反汇编出汇编代码，结合c语言文件找到每个关卡的入口函数，分析汇编代码，拆除炸弹。

1. 先将bobm3复制到共享文件夹之中；

2. 打开Ubuntu，输入objdump -d bomb > lu.txt

   ![img](https://wxt.sinaimg.cn/thumb300/0066mMjily1g0ueqfwajuj30e104sweb.jpg?tags=%5B%5D)

3. 就可以在bomb同目录下生成一个文件：lu.txt

   ![img](https://wxt.sinaimg.cn/thumb300/0066mMjily1g0ueqfwt8hj309h071dfs.jpg?tags=%5B%5D)

4. 里面是C程序的六个phase函数的汇编代码。



